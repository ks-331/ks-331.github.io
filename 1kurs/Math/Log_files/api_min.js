if(void 0===window.mailru)throw new Error("use loader.js to init the api");void 0===window.mailru.inited&&!function(){function a(a){var b="http-live";return""!==a.branch&&a.isHttps?b="https-alpha":""!==a.branch?b="http-alpha":a.prerelease?b="http-prerelease":a.isHttps&&(b="https-live"),b}function b(b){var c=mailru.loader.getEnv(),d={"http-live":"http://connect.mail.ru/","https-live":"https://connect.mail.ru/","http-alpha":"http://"+c.branch+".connect.myalpha15.i.mail.ru/","https-alpha":"https://"+c.branch+".connect.myalpha15.i.mail.ru/","http-prerelease":"http://connect.myalpha6.i.mail.ru/"},e=d[a(c)]+b+"?";return""!==c.branch?e+="__branch="+c.branch+"&":c.prerelease&&(e+="__prerelease=1&"),e}function c(){var b=mailru.loader.getEnv(),c={"http-live":"http://my1.imgsmail.ru","https-live":"https://my1.imgsmail.ru","http-alpha":"http://"+b.branch+".myalpha.imgsmail.ru","https-alpha":"https://"+b.branch+".myalpha.imgsmail.ru","http-prerelease":"http://psi.imgsmail.ru"},d=c[a(b)];return d}function d(){var b=mailru.loader.getEnv(),c={"http-live":"http://my.mail.ru/cgi-bin/connect/api/","https-live":"https://my.mail.ru/cgi-bin/connect/api/","http-alpha":"http://"+b.branch+".my.myalpha15.i.mail.ru/cgi-bin/connect/api/","https-alpha":"https://"+b.branch+".my.myalpha15.i.mail.ru/cgi-bin/connect/api/","http-prerelease":"http://my.myalpha6.i.mail.ru/cgi-bin/connect/api/"},d=c[a(b)];return d}function e(a){mailru.loader.getEnv();var b=mailru.loader.getEnv(),c=d()+a+"?";return""!==b.branch?c+="__branch="+b.branch+"&":b.prerelease&&(c+="__prerelease=1&"),c}function f(a){var b=mailru.loader.getEnv();return""!==b.branch?a.__branch=b.branch:b.prerelease&&(a.__prerelease=b.prerelease),a}function g(a){a=a||!1,mailru.intercom.init(a),mailru.isIE?mailru.utils.addHandler(window,"load",function(){mailru.connect.initButton()}):mailru.connect.initButton(),mailru.inited=!0;var b="#flash-transport-container {height: 0; font-size: 0;}.mrc__translayer {filter: progid:DXImageTransform.Microsoft.Alpha(opacity=70); -moz-opacity: 0.7; -khtml-opacity: 0.7; opacity: 0.7; background: #FFF url(//my1.imgsmail.ru/r/my/preloader_circle_32.gif) no-repeat center center; position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 999999; display: none}\n.mrc__translayer_on iframe {visibility: hidden;}.mrc__translayer_on {background-image:none;}";(mailru.isIE||mailru.isOpera)&&(b+=".mrc__translayer_on object {visibility: hidden}\n");var c=document.getElementsByTagName("head")[0],d=document.createElement("style"),e=document.createTextNode(b);d.type="text/css",d.styleSheet?d.styleSheet.cssText=e.nodeValue:d.appendChild(e),c.appendChild(d)}mailru.isApp=!1,mailru.app_id=-1,mailru.session=!1,mailru.inited=!1,mailru.def={DOMAIN:function(){try{return document.URL.match(/(?:https?:\/\/)?([^\/\?#]+)/i)[1]}catch(a){(new Image).src="//gstat.imgsmail.ru/gstat?api.param4=1&rnd="+Math.random();try{return document.domain}catch(b){return""}}}(),API_URL:function(){var a="//",b=mailru.loader.getEnv();return a+=""!==b.branch?b.branch+".myalpha15":b.prerelease?".myalpha6":"www",a+=".appsmail.ru/platform/japi"}(),PROXY_URL:b("proxy"),CONNECT_FORM_URL:"http://connect.mail.ru/connect?",CONNECT_LOGOUT_URL:"https://auth.mail.ru/cgi-bin/logout?app=1",CONNECT_OAUTH:b("oauth/authorize"),CONNECT_XDM_HELPER:"//connect.mail.ru/xdm.html",WIDGET_URL:"//my.mail.ru/cgi-bin/connect/api/",DIALOG_URL:"//my.mail.ru/cgi-bin/connect/api/",GET_DIALOG_URL:e,PLUGIN_URL:function(){var a,b,c,d="//connect.mail.ru/";try{a=document.location.search,b=a.match(/__branch=([a-z0-9\-]*)/i),c=null!==a.match(/__prerelease/i),b&&b.length>1?d="//"+b[1]+".connect.myalpha15.i.mail.ru/":c&&(d="//connect.myalpha6.i.mail.ru/")}catch(e){}return d}(),EMAIL:{BUTTON_URL:"http://my.mail.ru/cgi-bin/connect/plugin/email?layout=button&"},LIKE:{BUTTON_URL:b("share_button"),UBER_BUTTON_URL:b("share_button")+"uber-share=1&",CAPTCHA_URL:b("share")+"layout=captcha&",COMMENT_URL:b("share_comment")},PERMISSION_URL:"http://my.mail.ru/cgi-bin/connect/permissions?",CONNECT_COOKIE:"mrc",PARTNER_ID_COOKIE:"partner_id",CONNECT_BUTTON_BG_URL:c()+"/r/my/app/connect/connect-button.png",FLASH_TRANSPORT_URL:c()+"/r/my/app/flash_lc.swf",SESSION_REFRESH_EVERY:36e5};var h=[];mailru.batcher={isBatching:!1,start:function(){this.isBatching=!0},reqest:function(a,b,c){c=c||function(){};var d=mailru.callbacks.add(c);b=b||{},b.method=a,b.app_id=mailru.app_id,b.cb="mailru.callbacks["+d+"]",b.session_key=mailru.session.session_key||"",b=mailru.utils.sign(b),this.isBatching?h.push(b):mailru.utils.apiOverJSONP(b)},exec:function(){var a,b,c={};if(this.isBatching){if(this.isBatching=!1,b=h.length,a=b-1,b>0)for(;a>=0;)c["request"+a]=mailru.utils.makeGet(h[a]),a-=1;c.method="batcher",c.app_id=mailru.app_id,c.session_key=mailru.session.session_key||"",c=mailru.utils.sign(c),mailru.utils.apiOverJSONP(mailru.utils.sign(c)),h={}}}},mailru.utils={uniqid:function(){return Math.round(1e7*Math.random(+new Date+Math.random()))},apiOverJSONP:function(a,b){var c,d=document.getElementsByTagName("head")[0].appendChild(document.createElement("script"));d.type="text/javascript",b=b||mailru.def.API_URL,c=b+(-1===b.indexOf("?")?"?":"&")+mailru.utils.makeGet(a),d.src=c},utcDate:function(){return parseInt((new Date).getTime()/1e3,10)},requestOverProxy:function(a,b){var c,d,e;if("flash"===mailru.intercomType){if(!mailru.intercom.flash.flashReady)return mailru.events.listen(mailru.common.events.transportReady,function(){mailru.utils.requestOverProxy(a,b)}),!1;a.fcid=mailru.intercom.flash.params.fcid,a.app_id=mailru.app_id}return b=b||mailru.def.PROXY_URL,a.host=location.protocol+"//"+mailru.def.DOMAIN,c=b+mailru.utils.makeGet(a),mailru.isApp&&"xdm"===mailru.intercomType?d=new mrcXDM.Socket({windowName:!0,isHost:!0,remote:c+"&appProxy=1",onMessage:function(a){mailru.intercom.receiver(a)}}):(e=document.createElement("iframe"),e.src=c,e.style.border="0",e.style.position="absolute",e.style.left="-10000px",e.style.top="-10000px",e.style.height="0",document.body.insertBefore(e,document.body.getElementsByTagName("*")[0])),d},makeGet:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&(c[c.length]=b+"="+encodeURIComponent(a[b]));return c.join("&")},parseGet:function(a){var b,c=a.split("&"),d=c.length-1,e={};if(c.length>0)for(;d>=0;){b=c[d].indexOf("=");try{e[c[d].substr(0,b)]=decodeURIComponent(c[d].substr(b+1))}catch(f){}d-=1}return e},toArray:function(a){var b=[],c=a.length,d=c-1;if(c>0)for(;d>=0;)b[d]=a[d],d-=1;return b},fromJSON:function(a){if(void 0===a||""===a.replace(/\s+/,""))return void 0;try{return new Function("return "+a+";")()}catch(b){return a}},foreach:function(a,b){var c,d;if(void 0!==a.length)for(c=0;c<a.length;c+=1)b(a[c],c);else for(d in a)a.hasOwnProperty(d)&&b(a[d],d)},setCookie:function(a){return a&&a.name?(a.domain=a.domain||mailru.def.DOMAIN,a.path=a.path||"/",void(document.cookie=a.name+"="+window.escape(a.value)+(a.expires?"; expires="+new Date(a.expires).toUTCString():"")+(a.path?"; path="+a.path:"")+(a.domain?"; domain=."+a.domain:"")+(a.secure?"; secure":""))):!1},getCookie:function(a){var b=document.cookie.match(new RegExp("(^|;\\s*)"+a+"=([^;]+)(;|$)"));return b?window.unescape(b[2]):void 0},addHandler:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},mixin:function(a,b,c){var d;for(d in b)!b.hasOwnProperty(d)||c&&a[d]||(a[d]=b[d])},extend:function(a,b){var c,d={};for(c in b)b.hasOwnProperty(c)&&void 0===d[c]&&0!=c&&(a.hasOwnProperty(c)?mailru.utils.extend(a[c],b[c]):a[c]=b[c])},sign:function(a){var b,c,d=[],e=[],f="";for(b in a)a.hasOwnProperty(b)&&(d[d.length]=b);for(d=d.sort(),c=0;c<d.length;c+=1)e+=d[c]+"="+a[d[c]];return a.sig=mailru.utils.md5(f+mailru.session.vid+e+mailru.private_key),a},css:{getStyle:function(a,b){var c="string"==typeof a?document.getElementById(a):a,d=null;return c.currentStyle?d=c.currentStyle[b]:window.getComputedStyle&&(d=document.defaultView.getComputedStyle(c,null).getPropertyValue(b)),d}},md5:function(a){return mailru.utils.CryptoJS.MD5(a).toString()},modal:{open:function(a,b){var c,d;if(b.type&&"modal"===b.type&&mailru.utils.modal.windows.length&&mailru.utils.modal.windows.length>0)return b.wid=b.wid||mailru.utils.uniqid(),mailru.utils.modal.queue.add(a,b),b.wid;if(c=b.wid||mailru.utils.uniqid(),mailru.utils.modal.windows[c]=document.createElement("iframe"),void 0===b&&(b={}),void 0===b.id&&(b.id=c),void 0===b.id&&(b.name=b.id),void 0===b.url&&(b.url={}),b.url.wid=c,b.url.type=b.type,-1!==mailru.app_id&&(b.url.appid=mailru.app_id),b.url.app_id=mailru.app_id,mailru.session.session_key&&(b.url.session_key=mailru.session.session_key),"flash"===mailru.intercomType&&(b.url.fcid=mailru.intercom.flash.params.fcid),b.url.host=location.protocol+"//"+mailru.def.DOMAIN,a+=mailru.utils.makeGet(b.url),mailru.utils.modal.windows[c].frameBorder="0",mailru.utils.modal.windows[c].style.height=0,mailru.utils.modal.windows[c].allowtransparency="true",mailru.utils.modal.windows[c].scrolling="no",b.type&&(mailru.utils.modal.windows[c].modalType=b.type),b.style)for(d in b.style)b.style.hasOwnProperty(d)&&(mailru.utils.modal.windows[c].style[d]=b.style[d]);else b.style={};switch(mailru.utils.modal.tanslayer||(mailru.utils.modal.tanslayer=document.createElement("div")),b.type&&"modal"===b.type&&(mailru.utils.modal.windows.length+=1,mailru.utils.modal.tanslayer.style.display="block",mailru.utils.modal.tanslayer.className="mrc__translayer"),"ok"===b.url.tp&&"insertable"===b.url.type&&(a="http://connect.ok.ru/dk?st.cmd=WidgetShare&st.shareUrl="+b.url.url+"&st.fid="+b.id+'&st.settings={width:125,height:25,st:"oval",sz:'+b.url.sz+",ck:1}"),mailru.utils.modal.windows[c].src=a,b.type){case"modal":document.body.appendChild(mailru.utils.modal.windows[c]),mailru.utils.modal.tanslayer||(mailru.utils.modal.tanslayer=document.createElement("div")),mailru.utils.modal.tanslayer.className="mrc__translayer",mailru.utils.modal.tanslayer.style.display="block",mailru.isIE&&mailru.isOpera||(mailru.utils.modal.flashArray=document.getElementsByTagName("object")),mailru.utils.modal.tanslayer.appended||(document.body.appendChild(mailru.utils.modal.tanslayer),mailru.utils.modal.tanslayer.appended=!0);break;case"insertable":if(mailru.utils.modal.windows[c].setAttribute("allowTransparency",!0),b.insertOptions.insertAfter&&(b.place=b.place.nextSibling),b.insertOptions.position&&(mailru.utils.modal.windows[c].style.position="absolute",mailru.utils.modal.windows[c].style.left=b.insertOptions.position.left+"px",mailru.utils.modal.windows[c].style.top=b.insertOptions.position.top+"px"),b.insertOptions.body)document.body.appendChild(mailru.utils.modal.windows[c]);else if(b.insertOptions.wrap){var e=document.createElement("span");e.setAttribute("style","position: relative; left: 0; top: 0; margin: 0; padding: 0; visibility: visible;"),e.appendChild(mailru.utils.modal.windows[c]),b.place.parentNode.insertBefore(e,b.place)}else b.place.parentNode.insertBefore(mailru.utils.modal.windows[c],b.place);b.insertOptions.noreplace||(b.place.style.display="none")}if(mailru.utils.modal.windows[c].type=b.type,mailru.utils.modal.windows[c].name=b.name,mailru.utils.modal.windows[c].id=b.id,"modal"===b.type&&(mailru.utils.modal.windows[c].style.width=b.style.width||"515px",mailru.utils.modal.windows[c].style.height="0",mailru.utils.modal.windows[c].style.marginLeft="-10000px",mailru.utils.modal.windows[c].style.top="50%",mailru.utils.modal.windows[c].style.left="50%",mailru.utils.modal.windows[c].style.position="absolute",mailru.utils.modal.windows[c].style.zIndex="999999999"),"insertable"===b.type){if(mailru.utils.modal.windows[c].style.backgroundColor="transparent",b.url.width){switch(b.url.width=b.url.width.toString(),b.url.width.replace(/\d*/gim,"")){case"em":b.url.width=b.url.width.replace(/\D*/gim,"")+"em";break;case"px":b.url.width=b.url.width.replace(/\D*/gim,"")+"px";break;case"%":b.url.width=b.url.width.replace(/\D*/gim,"")+"%";break;default:b.url.width=b.url.width.replace(/\D*/gim,"")+"px"}mailru.utils.modal.windows[c].style.width=b.url.width}mailru.utils.modal.windows[c].style.height=b.url.height+"px"||""}return mailru.utils.modal.windows[c].style.border="solid #FFFF00 0px",mailru.events.listen(mailru.common.events.modalWindow,function(a){mailru.utils.modal.resize(a.wid,a.modalWindowWidth,a.modalWindowHeight)}),c},close:function(a){var b,c,d;if(void 0===mailru.utils.modal.windows[a])return!1;if(mailru.utils.modal.tanslayer&&(mailru.utils.modal.tanslayer.style.display="none"),document.body.className=document.body.className.replace("mrc__translayer_on",""),!mailru.isIE&&!mailru.isOpera)for(b=0;b<mailru.utils.modal.flashArray.length;b+=1)if(mailru.utils.modal.flashArray[b].style.zIndex=mailru.utils.modal.flashArray[b].originalZIndex,mailru.utils.modal.flashArray[b].noWmode)for(c=0;c<mailru.utils.modal.flashArray[b].childNodes.length;c+=1)"opaque"===mailru.utils.modal.flashArray[b].childNodes[c].value&&mailru.utils.modal.flashArray[b].removeChild(mailru.utils.modal.flashArray[b].childNodes[c]);void 0!==a&&void 0!==mailru.utils.modal.windows[a]&&null!==mailru.utils.modal.windows[a].parentNode&&(mailru.utils.modal.windows[a].parentNode.removeChild(mailru.utils.modal.windows[a]),mailru.utils.modal.windows[a].modalType&&"modal"===mailru.utils.modal.windows[a].modalType&&(mailru.utils.modal.windows.length-=1),delete mailru.utils.modal.windows[a],d=mailru.utils.modal.queue.get(),void 0!==d&&mailru.utils.modal.open(d.url,d.params))},resize:function(a,b,c){var d;if(void 0!==a&&void 0!==mailru.utils.modal.windows[a]){if("modal"===mailru.utils.modal.windows[a].type){for(d=0;d<mailru.utils.modal.flashArray.length;d+=1)mailru.isIE||mailru.isOpera||-1===mailru.utils.modal.flashArray[d].innerHTML.indexOf("wmode")&&(mailru.utils.modal.flashArray[d].noWmode=!0,mailru.utils.modal.flashArray[d].paramWmode='<param name="wmode" value="opaque" />',mailru.utils.modal.flashArray[d].innerHTML+=mailru.utils.modal.flashArray[d].paramWmode,mailru.utils.modal.flashArray[d].originalPosition=mailru.utils.getStyle(mailru.utils.modal.flashArray[d],"position"),"static"!==mailru.utils.modal.flashArray[d].originalPosition?(mailru.utils.modal.flashArray[d].originalZIndex=mailru.utils.getStyle(mailru.utils.modal.flashArray[d],"zIndex"),mailru.utils.modal.flashArray[d].style.zIndex="1"):mailru.utils.modal.flashArray[d].style.position="relative");document.body.setAttribute("class",(document.body.getAttribute("className")||"")+" mrc__translayer_on"),mailru.utils.modal.tanslayer.style.display="block"}setTimeout(function(){mailru.utils.modal.windows[a]&&(mailru.utils.modal.windows[a].frameborder="0",b&&"false"!==b&&(mailru.utils.modal.windows[a].style.width=parseInt(b,10)+"px",mailru.utils.modal.windows[a].modalType&&"modal"===mailru.utils.modal.windows[a].modalType&&(mailru.utils.modal.windows[a].style.marginLeft="-"+parseInt(b,10)/2+"px")),c&&(mailru.utils.modal.windows[a].style.height=parseInt(c,10)+"px"),mailru.utils.modal.windows[a].style.borderStyle="none",mailru.isApp||(mailru.utils.modal.windows[a].style.display="block"),"modal"===mailru.utils.modal.windows[a].type&&(mailru.utils.modal.windows[a].style.top=mailru.utils.modal.getScrollTop()+mailru.utils.modal.getWindowSize()/2-c/2+"px",mailru.utils.modal.windows[a].style.visibility="visible"))},5)}return!0},getScrollTop:function(){return window.self.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop},getWindowSize:function(){return"number"==typeof window.innerHeight?window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight?document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight?document.body.clientHeight:null))},translayer:null,flashArray:[],windows:{length:0},queue:{elements:null,add:function(a,b){this.elements||(this.elements=[]),this.elements.push({url:a,params:b}),this.length=this.elements.length},get:function(){var a;return this.length?(this.length-=1,a=this.elements[0]||!1,this.elements=this.elements.slice(1),a):void 0},length:0}},window:{getBody:function(a){return a||(a=window),a.document.body},getDocumentWidth:function(a){return a||(a=window),mailru.isIE?mailru.utils.window.getBody(a).scrollWidth:mailru.isOpera?a.document.body.style.pixelWidth:a.document.width},getDocumentHeight:function(a){return a||(a=window),mailru.isIE?mailru.utils.window.getBody(a).scrollHeight:mailru.isOpera?a.document.body.style.pixelHeight:a.document.height},getClientWidth:function(){return"CSS1Compat"!==document.compatMode||window.opera?document.body.clientWidth:document.documentElement.clientWidth},getClientHeight:function(){return"CSS1Compat"!==document.compatMode||window.opera?document.body.clientHeight:document.documentElement.clientHeight},getPosition:function(a){function b(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}function c(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{top:b,left:c}}return a.getBoundingClientRect?b(a):c(a)}}},mailru.utils.CryptoJS=function(a){var b,c,d,e,f,g,h,i,j,k={};return k.lib={},c=k.lib,c.Base=function(){function a(){return this}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){return void 0},mixIn:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=c.Base,c.WordArray=d.extend({init:function(a,b){a=this.words=a||[],void 0!==b?this.sigBytes=b:this.sigBytes=4*a.length},toString:function(a){return(a||b).stringify(this)},concat:function(a){var b,c,d=this.words,e=a.words,f=this.sigBytes,g=a.sigBytes;if(this.clamp(),f%4)for(b=0;g>b;b+=1)c=e[b>>>2]>>>24-b%4*8&255,d[f+b>>>2]|=c<<24-(f+b)%4*8;else if(e.length>65535)for(b=0;g>b;b+=4)d[f+b>>>2]=e[b>>>2];else d.push.apply(d,e);return this.sigBytes+=g,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=d.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){var c,d=[];for(c=0;b>c;c+=4)d.push(4294967296*a.random()|0);return new e.init(d,b)}}),e=c.WordArray,k.enc={},f=k.enc,f.Hex={stringify:function(a){var b,c,d=a.words,e=a.sigBytes,f=[];for(b=0;e>b;b+=1)c=d[b>>>2]>>>24-b%4*8&255,f.push((c>>>4).toString(16)),f.push((15&c).toString(16));return f.join("")},parse:function(a){var b,c=a.length,d=[];for(b=0;c>b;b+=2)d[b>>>3]|=parseInt(a.substr(b,2),16)<<24-b%8*4;return new e.init(d,c/2)}},b=f.Hex,f.Latin1={stringify:function(a){var b,c,d=a.words,e=a.sigBytes,f=[];for(b=0;e>b;b+=1)c=d[b>>>2]>>>24-b%4*8&255,f.push(String.fromCharCode(c));return f.join("")},parse:function(a){var b,c=a.length,d=[];for(b=0;c>b;b+=1)d[b>>>2]|=(255&a.charCodeAt(b))<<24-b%4*8;return new e.init(d,c)}},g=f.Latin1,f.Utf8={stringify:function(a){try{return decodeURIComponent(window.escape(g.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return g.parse(window.unescape(encodeURIComponent(a)))}},h=f.Utf8,c.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new e.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=h.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,f=c.sigBytes,g=this.blockSize,h=4*g,i=f/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j,k,l=i*g,m=a.min(4*l,f);if(l){for(j=0;l>j;j+=g)this._doProcessBlock(d,j);k=d.splice(0,l),c.sigBytes-=m}return new e.init(k,m)},clone:function(){var a=d.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),i=c.BufferedBlockAlgorithm,c.Hasher=i.extend({cfg:d.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){i.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new j.HMAC.init(a,c).finalize(b)}}}),k.algo={},j=k.algo,k}(Math),function(a){function b(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+e+g;return(h<<f|h>>>32-f)+b}function c(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+e+g;return(h<<f|h>>>32-f)+b}function d(a,b,c,d,e,f,g){var h=a+(b^c^d)+e+g;return(h<<f|h>>>32-f)+b}function e(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+e+g;return(h<<f|h>>>32-f)+b}var f=mailru.utils.CryptoJS,g=f.lib,h=g.WordArray,i=g.Hasher,j=f.algo,k=[];!function(){var b;for(b=0;64>b;b+=1)k[b]=4294967296*a.abs(a.sin(b+1))|0}(),j.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){var g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(g=0;16>g;g+=1)h=f+g,i=a[h],a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);j=this._hash.words,l=a[f],m=a[f+1],n=a[f+2],o=a[f+3],p=a[f+4],q=a[f+5],r=a[f+6],s=a[f+7],t=a[f+8],u=a[f+9],v=a[f+10],w=a[f+11],x=a[f+12],y=a[f+13],z=a[f+14],A=a[f+15],B=j[0],C=j[1],D=j[2],E=j[3],B=b(B,C,D,E,l,7,k[0]),E=b(E,B,C,D,m,12,k[1]),D=b(D,E,B,C,n,17,k[2]),C=b(C,D,E,B,o,22,k[3]),B=b(B,C,D,E,p,7,k[4]),E=b(E,B,C,D,q,12,k[5]),D=b(D,E,B,C,r,17,k[6]),C=b(C,D,E,B,s,22,k[7]),B=b(B,C,D,E,t,7,k[8]),E=b(E,B,C,D,u,12,k[9]),D=b(D,E,B,C,v,17,k[10]),C=b(C,D,E,B,w,22,k[11]),B=b(B,C,D,E,x,7,k[12]),E=b(E,B,C,D,y,12,k[13]),D=b(D,E,B,C,z,17,k[14]),C=b(C,D,E,B,A,22,k[15]),B=c(B,C,D,E,m,5,k[16]),E=c(E,B,C,D,r,9,k[17]),D=c(D,E,B,C,w,14,k[18]),C=c(C,D,E,B,l,20,k[19]),B=c(B,C,D,E,q,5,k[20]),E=c(E,B,C,D,v,9,k[21]),D=c(D,E,B,C,A,14,k[22]),C=c(C,D,E,B,p,20,k[23]),B=c(B,C,D,E,u,5,k[24]),E=c(E,B,C,D,z,9,k[25]),D=c(D,E,B,C,o,14,k[26]),C=c(C,D,E,B,t,20,k[27]),B=c(B,C,D,E,y,5,k[28]),E=c(E,B,C,D,n,9,k[29]),D=c(D,E,B,C,s,14,k[30]),C=c(C,D,E,B,x,20,k[31]),B=d(B,C,D,E,q,4,k[32]),E=d(E,B,C,D,t,11,k[33]),D=d(D,E,B,C,w,16,k[34]),C=d(C,D,E,B,z,23,k[35]),B=d(B,C,D,E,m,4,k[36]),E=d(E,B,C,D,p,11,k[37]),D=d(D,E,B,C,s,16,k[38]),C=d(C,D,E,B,v,23,k[39]),B=d(B,C,D,E,y,4,k[40]),E=d(E,B,C,D,l,11,k[41]),D=d(D,E,B,C,o,16,k[42]),C=d(C,D,E,B,r,23,k[43]),B=d(B,C,D,E,u,4,k[44]),E=d(E,B,C,D,x,11,k[45]),D=d(D,E,B,C,A,16,k[46]),C=d(C,D,E,B,n,23,k[47]),B=e(B,C,D,E,l,6,k[48]),E=e(E,B,C,D,s,10,k[49]),D=e(D,E,B,C,z,15,k[50]),C=e(C,D,E,B,q,21,k[51]),B=e(B,C,D,E,x,6,k[52]),E=e(E,B,C,D,o,10,k[53]),D=e(D,E,B,C,v,15,k[54]),C=e(C,D,E,B,m,21,k[55]),B=e(B,C,D,E,t,6,k[56]),E=e(E,B,C,D,A,10,k[57]),D=e(D,E,B,C,r,15,k[58]),C=e(C,D,E,B,y,21,k[59]),B=e(B,C,D,E,p,6,k[60]),E=e(E,B,C,D,w,10,k[61]),D=e(D,E,B,C,n,15,k[62]),C=e(C,D,E,B,u,21,k[63]),j[0]=j[0]+B|0,j[1]=j[1]+C|0,j[2]=j[2]+D|0,j[3]=j[3]+E|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f,g,h,i,j=a.floor(d/4294967296),k=d;for(c[(e+64>>>9<<4)+15]=16711935&(j<<8|j>>>24)|4278255360&(j<<24|j>>>8),c[(e+64>>>9<<4)+14]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8),b.sigBytes=4*(c.length+1),this._process(),f=this._hash,g=f.words,h=0;4>h;h+=1)i=g[h],g[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return f},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}});var l=j.MD5;f.MD5=i._createHelper(l),f.HmacMD5=i._createHmacHelper(l)}(Math),mailru.intercom={chunkBuff:[],chunkLen:0,chunkTimeout:null,chunkFinished:function(){},init:function(a){this.wrp=this[mailru.intercomType],this.wrp.init(a)},receiver:function(a){a=mailru.utils.parseGet(a),a.result&&(+a.rt?a.res_hash=mailru.utils.parseGet(a.result):a.res_hash=mailru.utils.fromJSON(a.result)),a.res_hash=a.res_hash||{},a.res_hash.error&&"102"===a.res_hash.error.error_code.toString()&&mailru.session&&mailru.events.notify(mailru.connect.events.logout),a.event?mailru.events.notify(a.event,a.res_hash,a.result):a.cbid&&mailru.callbacks[a.cbid]&&(a.chunk?(this.chunkBuff.length||(this.chunkLen=a.len,this.chunkFinished=function(a){return function(){mailru.callbacks[a]({result:mailru.intercom.chunkBuff.join("")}),mailru.intercom.chunkBuff=[],mailru.intercom.chunkLen=0,mailru.intercom.chunkFinished=function(){}}}(a.cbid)),window.clearTimeout(this.chunkTimeout),this.chunkTimeout=window.setTimeout(this.chunkFinished,3e3),this.chunkBuff[+a.index]=a.res_hash.result,this.chunkLen-=1,this.chunkLen||(window.clearTimeout(this.chunkTimeout),this.chunkFinished())):mailru.callbacks[a.cbid](a.res_hash,a.result))},makeRequest:function(a,b,c){return b=b||{},b.method=a,b.resource="app",c&&(b.cbid=mailru.callbacks.add(c)),b},wrp:{init:function(){},request:function(a,b,c){}},hash:{init:function(){mailru.utils.addHandler(window,"message",function(a){mailru.intercom.receiver(a.data)})},request:function(a,b,c){b=mailru.intercom.makeRequest(a,b,c),mailru.utils.requestOverProxy(b,mailru.def.PROXY_URL)}},event:{init:function(){mailru.utils.addHandler(window,"message",function(a){mailru.intercom.receiver(a.data)})},request:function(a,b,c){b=mailru.intercom.makeRequest(a,b,c),mailru.isIE&&"showStreamPublish"===b.method&&mailru.utils.makeGet(b).length>2500&&(b.posttitle.length>80&&(b.posttitle=b.posttitle.substring(0,80)+"..."),b.apptext.length>200&&(b.apptext=b.apptext.substring(0,200)+"...")),parent.postMessage(mailru.utils.makeGet(b),"*")}},flash:{transport:"",params:{},toSend:[],flashReady:!1,insertFlash:function(){var a="";mailru.intercom.flash.transport=document.createElement("div"),document.body.insertBefore(mailru.intercom.flash.transport,document.body.getElementsByTagName("*")[0]),mailru.intercom.flash.transport.id="flash-transport-container",mailru.intercom.flash.transport.innerHTML=a+'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="api-lcwrapper" name="api-lcwrapper" height="1" width="1" type="application/x-shockwave-flash"><param value="always" name="allowScriptAccess"/><param value="'+mailru.def.FLASH_TRANSPORT_URL+'" name="movie"/><param value="'+mailru.intercom.flash.vars+'" name="FlashVars"/></object>'},init:function(a){document.URL.match(/\?(.*)/)&&(mailru.intercom.flash.params.fcid=mailru.utils.parseGet(document.URL.match(/\?(.*)/)[0]).fcid),mailru.intercom.flash.params.fcid&&void 0!==mailru.intercom.flash.params.fcid||(mailru.intercom.flash.params.fcid=mailru.utils.parseGet(window.name).fcid),mailru.intercom.flash.params.fcid&&void 0!==mailru.intercom.flash.params.fcid||(mailru.intercom.flash.params.fcid=mailru.utils.uniqid()),mailru.intercom.flash.vars=mailru.utils.makeGet({CBReceive:"mailru.intercom.flash.receive",CBReady:"mailru.intercom.flash.ready",listenTo:"api",connectTo:"server",cid:mailru.intercom.flash.params.fcid,host:mailru.def.DOMAIN,role:"server",noOpposite:a?1:0}),mailru.intercom.flash.insertFlash()},request:function(a,b,c){var d,e;b=mailru.utils.makeGet(mailru.intercom.makeRequest(a,b,c)),d=document.getElementById("api-lcwrapper"),d&&d.send?d.send(b):(mailru.intercom.flash.toSend.push(b),mailru.events.listen(mailru.common.events.transportReady,function(){for(e=mailru.intercom.flash.toSend.length-1;e>=0;e-=1)document.getElementById("api-lcwrapper").send(mailru.intercom.flash.toSend[e])})),d=null},receive:function(a){mailru.intercom.receiver(a)},ready:function(){-1!==navigator.appName.indexOf("Microsoft")?mailru.intercom.flash.transport=window["api-lcwrapper"]:mailru.intercom.flash.transport=document["api-lcwrapper"],mailru.intercom.flash.flashReady=!0,mailru.events.notify(mailru.common.events.transportReady)}}},mailru.callbacks={add:function(a){var b=mailru.utils.uniqid();return mailru.callbacks[b]=function(){delete mailru.callbacks[b],a&&a.apply(window,arguments)},b}},mailru.events={listeners:{},hidHash:{},listen:function(a,b){var c,d;return a=mailru.events.alias[a]||a,this.listeners[a]=this.listeners[a]||{index:-1,list:{}},this.listeners[a].index+=1,c=this.listeners[a].index,this.listeners[a].list[c]=b,d=mailru.utils.uniqid(),this.hidHash[d]=[a,c],d},remove:function(a){this.hidHash[a]&&delete this.listeners[this.hidHash[a][0]].list[this.hidHash[a][1]]},notify:function(a){var b;"event"!==a&&(b=mailru.utils.toArray(arguments),b.unshift("event"),this.notify.apply(this,b)),b=mailru.utils.toArray(arguments).splice(1,arguments.length),this.listeners[a]&&-1!==this.listeners[a].index&&mailru.utils.foreach(this.listeners[a].list,function(a){a.apply(window,b)})},alias:{"stream.post":"common.streamPublish","mailru.common.events.streamPublish":"common.streamPublish","message.post":"common.sendMessage","guestbook.post":"common.guestbookPublish","mailru.common.events.guestbookPublish":"common.guestbookPublish","common.upload":mailru.isApp?"common.upload":"common.uploadPhoto","mailru.common.events.upload":"common.upload","mailru.common.events.uploadAvatar":"common.uploadAvatar","mailru.app.events.friendsInvitation":"common.friendsInvitation","mailru.app.events.friendsRequest":"common.friendsRequest","mailru.common.events.createAlbum":"common.createAlbum","mailru.common.events.friends.add":"common.friends.add","mailru.common.events.gift.send":"common.gift.send","mailru.app.events.incomingPayment":"app.incomingPayment","mailru.app.events.paymentDialogStatus":"app.paymentDialogStatus","mailru.app.events.hash.read":"app.hash.read","mailru.app.events.scrollTo":"app.scrollY"}},mailru.common={email:{getUnreadCount:function(a){mailru.batcher.reqest("email.getUnreadCount",{uid:mailru.session.vid||""},a)}},messages:{getUnreadCount:function(a){mailru.batcher.reqest("messages.getUnreadCount",{},a)},getThreadsList:function(a,b){b=b||{},mailru.batcher.reqest("messages.getThreadsList",{offset:b.offset||0,limit:b.limit||10},a)},getThread:function(a,b,c){c=c||{},mailru.batcher.reqest("messages.getThread",{uid:b||mailru.session.vid||"",offset:c.offset||0,limit:c.limit||10},a)},send:function(a,b){if("function"==typeof a&&(a=b),!a.uid)throw new Error("No recipient UID");mailru.isApp?(a.session_key=mailru.session.session_key,a.appid=mailru.app_id,mailru.intercom.wrp.request("showSendMessageDialog",f(a))):mailru.utils.modal.open(e("send_message"),{url:a,type:"modal"})}},users:{requirePermissions:function(a,b){"function"==typeof a&&(a=b),mailru.common.users.requirePermission(a)},requirePermission:function(a,b){"function"==typeof a&&(a=b),mailru.events.notify(mailru.common.events.permissionsChange,{status:"closed"})},getInfo:function(a,b){("string"==typeof b||"number"==typeof b)&&(b=arguments.length>2?arguments.splice(3,arguments.length):[b]),(void 0===b||0===b.length)&&(b=[mailru.session.vid]),mailru.batcher.reqest("users.getInfo",{uids:b.join(",")},a)},getPermissions:function(){},hasAppPermission:function(a,b,c){mailru.batcher.reqest("users.hasAppPermission",{uid:c||mailru.session.vid||"",ext_perm:b},a)},getBalance:function(a,b){mailru.batcher.reqest("users.getBalance",{uid:b||mailru.session.vid},a)}},stream:{publish:function(a,b){var c,d;if("function"==typeof a&&(a=b),c={posttitle:a.title||"",apptext:a.text||"",pic:a.img_url||a.imgURL||""},c.id="stream-publish",a.action_links=a.action_links||a.actionLinks||!1,a.action_links)for(d=1;d<=a.action_links.length;d+=1)c["link_"+d+"_text"]=a.action_links[d-1].text,c["link_"+d+"_href"]=a.action_links[d-1].href;mailru.isApp?(c.session_key=mailru.session.session_key,c.appid=mailru.app_id,mailru.intercom.wrp.request("showStreamPublish",f(c))):(c.url=c,c.type="modal",mailru.utils.modal.open(e("stream_publish"),c))},post:function(a,b){"function"==typeof a&&(a=b),mailru.common.stream.publish(a)},get:function(a,b){b=b||{},mailru.batcher.reqest("stream.get",{offset:b.offset||0,limit:b.limit||10,
filter_app:b.filter_app||""},a)},getByAuthor:function(a,b,c){c=c||{},mailru.batcher.reqest("stream.getByAuthor",{uid:b||mailru.session.vid,offset:c.offset||0,limit:c.limit||10,filter_app:c.filter_app||""},a)}},guestbook:{publish:function(a,b){var c,d;if("function"==typeof a&&(a=b),void 0===a.uid&&(a.uid=mailru.session.vid),c={url:{uid:a.uid.toString(),title:a.title||"",text:a.text||"",img:a.img_url||a.imgURL||""},type:"modal"},c.id="guestbook-publish",a.action_links=a.action_links||a.actionLinks||!1,a.action_links)for(d=1;d<=a.action_links.length;d+=1)try{c.url["link_"+d+"_text"]=a.action_links[d-1].text,c.url["link_"+d+"_href"]=a.action_links[d-1].href}catch(g){}mailru.isApp?mailru.intercom.wrp.request("showGuestbookPublish",f({app_id:mailru.app_id,text:c.url.text,title:c.url.title,img:c.url.img,uid:c.url.uid,link_1_text:c.url.link_1_text||"",link_1_href:c.url.link_1_href||"",link_2_text:c.url.link_2_text||"",link_2_href:c.url.link_2_href||"",session_key:mailru.session.session_key})):mailru.utils.modal.open(e("publish_guestbook"),c)},post:function(a,b){"function"==typeof a&&(a=b),a.text=a.text||a.description,a.description&&delete a.description,mailru.common.guestbook.publish(a)},get:function(a,b,c){c=c||{},mailru.batcher.reqest("guestbook.get",{uid:b||mailru.session.vid||"",offset:c.offset||0,limit:c.limit||10},a)}},photos:{getAlbums:function(a,b){mailru.batcher.reqest("photos.getAlbums",{uid:b||mailru.session.vid||""},a)},get:function(a,b,c,d,e){mailru.batcher.reqest("photos.get",{pids:c||"",aid:b,offset:d||0,limit:e||0},a)},createAlbum:function(a,b){"function"==typeof a&&(a=b),void 0===a&&(a={}),void 0===a.name&&(a.name="Без названия"),a.toSend={url:{album_name:a.name},type:"modal"},a=a.toSend,a.id="create-album",mailru.isApp?mailru.intercom.wrp.request("showAlbumCreation",f({app_id:mailru.app_id,album_name:a.url.album_name,session_key:mailru.session.session_key})):mailru.utils.modal.open(e("create_album"),a)},upload:function(a,b){"function"==typeof a&&(a=b),a.img=a.img||a.url,a.toSend={url:{img:a.img,aid:a.aid,set_as_cover:a.set_as_cover||!1,title:a.title||a.name||"",desc:a.description||a.desc||"",category:a.theme||a.category||"",tags:a.tags||""},type:"modal"},a=a.toSend,a.id="upload-photo",mailru.isApp?mailru.intercom.wrp.request("showPhotoUpload",f({app_id:mailru.app_id,img:a.url.img,aid:a.url.aid,title:a.url.title||"",desc:a.url.desc||"",category:a.url.category||"",tags:a.url.tags||"",set_as_cover:a.url.set_as_cover||"",session_key:mailru.session.session_key})):mailru.utils.modal.open(e("upload_photo"),a)},uploadAvatar:function(a,b){var c={app_id:mailru.app_id,session_key:mailru.session.session_key};"function"==typeof a&&(a=b),void 0!==a.url?c.img_url=a.url:c.pid=a.pid,mailru.isApp?mailru.intercom.wrp.request("showSetAvatar",f(c)):mailru.utils.modal.open(e("avatar_set"),{type:"modal",url:c})}},audio:{search:function(a,b,c,d){if(void 0===b)throw new Error("audio search failed:\nno QUERY");mailru.batcher.reqest("audio.search",{query:b,offset:c||0,limit:d||10},a)},link:function(a,b){if(void 0===b)throw new Error("get audio link failed:\nno MID");mailru.batcher.reqest("audio.link",{mid:b},a)},get:function(a,b,c){mailru.batcher.reqest("audio.get",{uid:b||mailru.session.vid||"",mid:c||""},a)}},friends:{add:function(a,b){var c,d;"function"==typeof a&&(a=b),c={url:{uid:a},type:"modal"},mailru.session||(d=mailru.utils.parseGet(mailru.utils.getCookie(mailru.def.CONNECT_COOKIE)),c.session_key=d.session_key),mailru.isApp?mailru.intercom.wrp.request("showAddFriend",f({app_id:mailru.app_id,uid:a,session_key:mailru.session.session_key})):mailru.utils.modal.open(e("add_friend"),c)},getFiltered:function(a,b,c){mailru.batcher.reqest("friends.get",{uid:b||mailru.session.vid||"",offset:c||0},a)},getExtended:function(a,b,c){mailru.batcher.reqest("friends.get",{uid2:b||mailru.session.vid||"",ext:1,offset:c||0},a)},getAppUsers:function(a,b,c,d){mailru.batcher.reqest("friends.getAppUsers",{uid:c||mailru.session.vid||"",ext:b?1:0,offset:d||0},a)},getInvitationsCount:function(a){mailru.batcher.reqest("friends.getInvitationsCount",{uid:mailru.session.vid||""},a)}},payments:{showDialog:function(a,b){if("function"==typeof a&&(a=b),a.app_id=mailru.app_id,mailru.isApp)mailru.intercom.wrp.request("showPaymentDialog",f(a));else{if(a.window_id=mailru.window_id,a.mailiki_price*=100,a.url=a,a.session_key=mailru.session.session_key,a.type="modal",a.style={width:"675px"},!mailru.session)throw new Error("No user session");mailru.connect.activePaymentWindow=mailru.utils.modal.open(e("payment_dialog"),a)}}},gift:{send:function(a,b,c){if(void 0===a)throw new Error("No gift id");"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var d={};d.app_id=mailru.app_id,mailru.isApp?(d.gift_id=a,d.text=b||"",d.friend_id=c.join(","),mailru.intercom.wrp.request("showGiftSendDialog",f(d))):(d.url={"interface":"gift.send",gift_id:a,text:b||"",friend_id:c.join(",")},d.type="modal",d.style={width:"675px"},mailru.utils.modal.open(e("friends_select"),d))}},events:{permissionChanged:"common.permissionChanged",permissionsChange:"common.permissionChanged",friendsInvitation:"common.friendsInvitation",message:{send:"common.sendMessage"},streamPublish:"common.streamPublish",modalWindow:"common.modalWindow",requireWidgetPermissions:"common.requireWidgetPermissions",createAlbum:"common.createAlbum",upload:"common.upload",uploadAvatar:"common.uploadAvatar",guestbookPublish:"common.guestbookPublish",transportReady:"common.transportReady",friends:{add:"common.friends.add"},gift:{send:"common.gift.send"},paymentDialogStatus:"common.paymentDialogStatus"}},mailru.app={init:function(a){var b,c;if(mailru.isApp=!0,mailru.inited||g(),a&&(mailru.private_key=a),c=(document.URL.match(/\?(.*)/)||[0,""])[1],b=mailru.utils.parseGet(c),b.app_id&&b.session_key||(c=mailru.utils.getCookie(mailru.def.CONNECT_COOKIE)||"",""===c&&(c=mailru.utils.parseGet(window.name).cookie),b=mailru.utils.parseGet(c)),!b.app_id)throw new Error("API INIT FAILED:\nno APP ID");if(!b.session_key)throw new Error("API INIT FAILED:\nno No SESSION KEY");mailru.app_id=b.app_id,mailru.app.dispatchSession(b,c),mailru.utils.extend(mailru.app,mailru.common)},users:{requireInstallation:function(a){mailru.events.notify(mailru.app.events.applicationInstallation,{status:"success"})},isAppUser:function(a,b){mailru.batcher.reqest("users.isAppUser",{uid:b||mailru.session.vid||""},a)},review:function(){mailru.intercom.wrp.request("showReviewDialog",{app_id:mailru.app_id})},events:{getNewCount:function(a,b){mailru.batcher.reqest("events.getNewCount",{uid:b||mailru.session.vid||""},a)}}},widget:{set:function(){return mailru.events.notify(mailru.app.events.widget.set,{status:"closed"}),!1}},friends:{invite:function(){var a={app_id:mailru.app_id,method:"jsapi.popup",session_key:mailru.session.session_key,vid:mailru.session.vid,template:"friends.invite"},b=mailru.loader.getEnv();""!==b.branch?a.__branch=b.branch:b.prerelease&&(a.__prerelease=b.prerelease),mailru.intercom.wrp.request("showInviteFriendsDialog",mailru.utils.sign(a))},request:function(a,b){if(a=a||{},"function"==typeof a&&(a=b||{}),!a.text||!a.image_url)throw new Error("Missing required params: "+(a.text?"":"text\n")+(a.image_url?"":"image_url\n"));a.friends instanceof Array&&(a.friends=a.friends.join(",")),mailru.intercom.wrp.request("showRequestFriendsDialog",{app_id:mailru.app_id,text:a.text,image_url:a.image_url,friends:a.friends||!1,hash:a.hash||!1})}},payments:{showDialog:function(a,b){"function"==typeof a&&(a=b),mailru.common.payments.showDialog.call(mailru,a)},openDialog:function(a,b){"function"==typeof a&&(a=b),mailru.common.payments.showDialog.call(mailru,a)}},setLocation:function(){},getLocation:function(){},resizeWindow:function(){},scrollWindow:function(){},setTitle:function(a,b){"function"==typeof a&&(a=b),mailru.app.utils.setTitle(a)},utils:{getScrollY:function(a){"use strict";mailru.intercom.wrp.request("scrollTo")},setScrollY:function(a,b){"use strict";"function"==typeof a?a.scroll=b:void 0!==window.scroll&&(a.scroll=window.scroll),mailru.intercom.wrp.request("scrollTo",a)},setTitle:function(a,b){"function"==typeof a&&(a=b),null!==a&&"undefined"!==a&&mailru.intercom.wrp.request("setTitle",{app_id:mailru.app_id,title:a})},setHeight:function(a,b){"function"==typeof a&&(a=b),a&&mailru.intercom.wrp.request("setIframeHeight",{app_id:mailru.app_id,height:a})},hash:{write:function(a,b){var c;return"function"==typeof a&&(a=b),void 0===a?!1:(c="string"==typeof a?a:mailru.utils.makeGet(a),void mailru.intercom.wrp.request("writeHash",{hash:c}))},read:function(){var a=mailru.utils.parseGet(window.name),b=decodeURIComponent(a.fast_hash);"undefined"!==b?(mailru.app.utils.hash.fastHash=b,delete a.fast_hash,window.name=mailru.utils.makeGet(a),mailru.app.utils.hash.initRead()):(mailru.app.utils.hash.initRead(),mailru.intercom.wrp.request("readHash"))},initRead:function(){function a(a){var b="";b="string"==typeof a?a:a.hash,b=mailru.utils.parseGet(b),mailru.events.notify("app.hash.read",b),mailru.events.notify("app.readHash",b)}return mailru.app.utils.hash.inited&&!mailru.app.utils.hash.fastHash?!1:(mailru.app.utils.hash.fastHash&&(a(mailru.app.utils.hash.fastHash),mailru.app.utils.hash.fastHash=!1),mailru.events.listen(mailru.app.events.appReadHash,function(b){a(b)}),void(mailru.app.utils.hash.inited=!0))},inited:!1,fastHash:!1},scrollTo:function(a,b){var c={};"function"==typeof a?c.scroll=b:void 0!==a&&(c.scroll=a),mailru.intercom.wrp.request("scrollTo",c)}},events:{windowBlur:"app.windowBlur",windowFocus:"app.windowFocus",locationChange:"app.locationChange",windowResize:"app.windowResize",applicationInstallation:"app.applicationInstallation",friendsInvitation:"app.friendsInvitation",friendsRequest:"app.friendsRequest",applicationSettingsStatus:"app.settings",applicationReviewStatus:"app.review",incomingPayment:"app.incomingPayment",requireInstallation:"app.requireInstallation",appReadHash:"app.appReadHash",readHash:"app.readHash",scrollTo:"app.scrollTo",hash:{read:"app.hash.read"},like:"app.like",widget:{set:"app.widget.set"},paymentDialogStatus:"app.paymentDialogStatus"},getLoginStatus:function(a){mailru.utils.requestOverProxy({resource:"getLoginStatus",app_id:mailru.app_id,cbid:mailru.callbacks.add(function(b,c){mailru.app.dispatchSession(b,c),a&&a(b,c)})})},dispatchSession:function(a,b){!a.session_expire&&a.exp&&(a.session_expire=a.exp),a.session_expire||(a.session_expire=mailru.def.SESSION_REFRESH_EVERY),mailru.session=a,mailru.app.prolongSession(a);var c=mailru.utils.parseGet(window.name);c.cookie=b,window.name=mailru.utils.makeGet(c),mailru.utils.setCookie({name:mailru.def.CONNECT_COOKIE,value:b})},clearSession:function(){mailru.session=!1,window.clearTimeout(mailru.app.prolongSessionTmr)},prolongSessionTmr:null,prolongSession:function(a){window.clearTimeout(mailru.app.prolongSessionTmr),mailru.app.prolongSessionTmr=window.setTimeout(function(){mailru.app.getLoginStatus()},mailru.def.SESSION_REFRESH_EVERY)}},mailru.connect={appAutoInstall:function(a,b,c,d){mailru.utils.requestOverProxy({resource:"app.auto_install",app_id:a,cbid:mailru.callbacks.add(function(a){a.length>1&&"string"!=typeof a[2]&&void 0!==a[2].success?(c={app_id:c.app_id,exp:a[2].exp,ext_perm:"notifications",is_app_user:1,oid:a[2].vid,session_key:a[2].session_key,ss:a[2].ss,state:"",vid:a[2].vid,sig:a[2].sig,window_id:c.window_id},d=mailru.utils.makeGet(c),mailru.connect.dispatchSession(c,d),"function"==typeof b&&b(c,d)):"function"==typeof b&&b(c,d)})})},init:function(a,b,c){function d(a){void 0!==a&&a.wid&&"undefined"!==a.wid&&"opened"!==a.wid&&mailru.utils.modal.close(a.wid)}function e(a){void 0!==a&&a.wid&&"undefined"!==a.wid&&"opened"!==a.status&&mailru.utils.modal.close(a.wid)}if(!a)throw new Error("API INIT FAILED:\nno APP ID");if(!b)throw new Error("API INIT FAILED:\nno PRIVATE KEY");mailru.isGame=c||!1,a&&(mailru.app_id=a),mailru.partner_id=mailru.utils.getCookie(mailru.def.PARTNER_ID_COOKIE),mailru.inited||g(1),mailru.utils.extend(mailru.connect,mailru.common),b&&(mailru.private_key=b),mailru.events.listen(mailru.connect.events.loginOAuth,mailru.connect.dispatchSession),mailru.events.listen(mailru.connect.events.logout,mailru.connect.clearSession),mailru.events.listen(mailru.connect.events.loginFail,mailru.connect.loginFail),mailru.connect.getLoginStatus(),mailru.events.listen(mailru.common.events.streamPublish,d),mailru.events.listen(mailru.common.events.guestbookPublish,d),mailru.events.listen(mailru.common.events.friends.add,d),mailru.events.listen(mailru.common.events.upload,d),mailru.events.listen(mailru.common.events.uploadAvatar,d),mailru.events.listen(mailru.common.events.permissionChanged,d),mailru.events.listen(mailru.common.events.createAlbum,d),mailru.events.listen(mailru.common.events.message.send,d),mailru.events.listen(mailru.common.events.paymentDialogStatus,e),mailru.events.listen(mailru.common.events.gift.send,e),mailru.events.listen(mailru.app.events.incomingPayment,function(){setTimeout(function(){mailru.utils.modal.close(mailru.connect.activePaymentWindow)},3e3)})},initButton:function(){function a(a){return mailru.connect.login(),!1}var b=document.getElementsByTagName("a"),c=b.length,d=0,e=null;for(0;c>d;d+=1)-1!==b[d].className.indexOf("mrc__connectButton")&&(e=b[d],e.innerHTML="",e.style.background="url("+mailru.def.CONNECT_BUTTON_BG_URL+") no-repeat",e.style.display="inline-block",e.style.width="115px",e.style.height="18px",e.href="#r",e.onclick=a)},login:function(a){var b,c,d;if(mailru.session&&mailru.session.is_app_user)mailru.events.notify(mailru.connect.events.login,mailru.session,mailru.utils.getCookie(mailru.def.CONNECT_COOKIE));else{b={app_id:mailru.app_id,host:"http://"+mailru.def.DOMAIN},"flash"===mailru.intercomType&&(b.fcid=mailru.intercom.flash.params.fcid),a=a||"";try{a=a.join().match(/\w*/g).join(" ")}catch(e){a=a.match(/\w*/g).join(" ")}if(c=mailru.def.CONNECT_OAUTH+"client_id="+mailru.app_id+"&response_type=token&display=popup&redirect_uri="+encodeURIComponent(mailru.def.PROXY_URL+"app_id="+mailru.app_id+"&login=1"+(b.fcid?"&fcid="+b.fcid:"")+(b.host?"&host="+b.host:""))+"&"+mailru.utils.makeGet(b)+"&"+mailru.utils.makeGet({scope:a})+(mailru.partner_id?"&site_id="+encodeURIComponent(mailru.partner_id):"")+(mailru.isGame?"&game=1":""),d=window.open(c,"mrc_login","width=445, height=400, status=0, scrollbars=0, menubar=0, toolbar=0, resizable=1"),mailru.isOpera)window.onfocus=function(){mailru.session.login||(window.onfocus=null,mailru.events.notify(mailru.connect.events.loginFail))};else if(void 0!==d&&null!==d)var f=setInterval(function(){d.closed&&clearInterval(f)},500);else mailru.session.login||mailru.events.notify(mailru.connect.events.loginFail)}},logout:function(){mailru.utils.apiOverJSONP(mailru.utils.sign({cb:"mailru.callbacks["+mailru.callbacks.add(function(a){a.result&&mailru.events.notify(mailru.connect.events.logout)})+"]",app_id:mailru.app_id}),mailru.def.CONNECT_LOGOUT_URL)},loginFail:function(){},getLoginStatus:function(a){mailru.utils.requestOverProxy({resource:"getLoginStatus",app_id:mailru.app_id,cbid:mailru.callbacks.add(function(b,c){var d=mailru.utils.parseGet(c);void 0!==d.connectPartner&&d.connectPartner>0&&void 0!==a?mailru.connect.appAutoInstall(mailru.app_id,a,b,c):(mailru.connect.dispatchSession(b,c),"function"==typeof a&&a(b,c))})})},events:{login:"connect.login",loginOAuth:"connect.loginOAuth",logout:"connect.logout",loginFail:"connect.loginFail"},dispatchSession:function(a,b,c){return a.access_token?(mailru.connect.getLoginStatus(function(){mailru.events.notify(mailru.connect.events.login,mailru.session,mailru.utils.getCookie(mailru.def.CONNECT_COOKIE))}),!1):(mailru.session=a,mailru.isGame&&mailru.session.window_id&&!mailru.cometInited&&mailru.session&&mailru.session.is_app_user&&(mailru.cometInited=!0,mailru.utils.requestOverProxy({comet:1,app_id:mailru.app_id,window_id:mailru.session.window_id})),"0"!==a.is_app_user.toString()||c?mailru.connect.prolongSession(a):mailru.connect.clearSession(),void mailru.utils.setCookie({name:mailru.def.CONNECT_COOKIE,value:b}))},clearSession:function(){mailru.session=!1,window.clearTimeout(mailru.connect.prolongSessionTmr),mailru.utils.setCookie({name:mailru.def.CONNECT_COOKIE,expires:-1,value:""})},prolongSessionTmr:null,prolongSession:function(a){window.clearTimeout(mailru.connect.prolongSessionTmr),mailru.connect.prolongSessionTmr=window.setTimeout(function(){mailru.connect.getLoginStatus()},mailru.def.SESSION_REFRESH_EVERY)}},mailru.plugin={inited:!1,elements:{},init:function(){return mailru.inited||g(1),mailru.plugin.inited||(mailru.events.listen(mailru.plugin.events.closeLikeComment,function(a){mailru.utils.modal.close(a.share?mailru.plugin.like.buttonsWithComment[a.wid]:a.wid)}),mailru.events.listen(mailru.plugin.events.unliked,function(a){mailru.plugin.like.closeAllComments()}),mailru.events.listen(mailru.plugin.events.liked,function(a){mailru.plugin.like.closeAllComments(function(){a.noComment||mailru.plugin.like.Comment(a)})}),mailru.events.listen(mailru.plugin.events.like.rlOK,function(a){mailru.plugin.like.closeAllComments(function(){mailru.plugin.like.Comment(a)})}),mailru.events.listen(mailru.plugin.events.like.rl,function(a){mailru.plugin.like.rl(a)}),mailru.events.listen(mailru.plugin.events.errorMessage,function(a){mailru.plugin.like.closeAllComments(function(){mailru.plugin.like.errorMessage(a.wid,a.errorType,a.buttonType)})}),mailru.events.listen(mailru.plugin.events.like.comment,function(a){mailru.plugin.like.closeAllComments(function(){mailru.plugin.like.Comment(a)})}),mailru.utils.addHandler(document.body,"click",function(a){var b,c;a=a||window.event,b=a.target||a.srcElement;for(c in mailru.plugin.like.buttonsWithComment)mailru.plugin.like.buttonsWithComment.hasOwnProperty(c)&&b.id!==mailru.plugin.like.buttonsWithComment[c]&&mailru.utils.modal.close(mailru.plugin.like.buttonsWithComment[c])}),mailru.events.listen(mailru.plugin.events.email.redirect,function(a){mailru.plugin.email.redirectTo(a.url)}),mailru.plugin.inited=!0),mailru.isIE&&mailru.isIE<11?(document.attachEvent&&!function(){try{document.documentElement.doScroll("left")}catch(a){return void setTimeout(mailru.plugin.init,0)}mailru.plugin.find()}(),!1):void mailru.plugin.find()},find:function(){var a,b=document.getElementsByTagName("a"),c=b.length,d=null;for(a=0;c>a;a+=1)if(void 0!==b[a]&&-1!==b[a].className.indexOf("mrc__plugin")&&!b[a].processed){if(d=b[a],d.type=d.className.match(/^[mrc__Plugin_]\w*/gim)[0],d.type=null!==d.type?d.type.replace("mrc__plugin_",""):null,d.params=!1,d.getAttribute("data-mrc-config"))try{d.params=0!==d.getAttribute("data-mrc-config").length?JSON.parse(d.getAttribute("data-mrc-config").replace(new RegExp("\\n","g"),"").replace(/'/g,'"')):!1}catch(e){d.params=!1}if(!d.params)try{d.params=0!==d.rel.length?JSON.parse(d.rel.replace(new RegExp("\\n","g"),"").replace(/'/g,'"')):{}}catch(e){d.params={}}d.params.domain||(d.params.domain=document.domain),null!==d.type&&mailru.plugin.insert(d)}},insert:function(a){a.insertOptions={};var b=mailru.def.PLUGIN_URL+a.type+"?";switch(a.type){case"like_button":mailru.plugin.like.Button(a),b=mailru.def.LIKE.BUTTON_URL;break;case"uber_like_button":mailru.plugin.like.Button(a),a.params.cp=1,b=mailru.def.LIKE.UBER_BUTTON_URL;break;case"email_button":b=mailru.def.EMAIL.BUTTON_URL;break;case"recommendations":return a.style.display="none",!1;case"groups_widget":b=mailru.def.PLUGIN_URL+"groups_widget?"}var c=0;c=mailru.utils.modal.open(b,{type:"insertable",place:a,url:a.params,insertOptions:a.insertOptions,wid:mailru.utils.uniqid()}),a.processed=!0,mailru.plugin.elements[c]=a.params},events:{liked:"plugin.liked",unliked:"plugin.unliked",likeCommented:"plugin.likeCommented",closeLikeComment:"plugin.closeComment",errorMessage:"plugin.errorMessage",like:{liked:"plugin.like.liked",unliked:"plugin.like.unliked",commented:"plugin.like.Commented",closeComment:"plugin.like.closeComment",errorMessage:"plugin.like.errorMessage",rl:"plugin.like.rl",rlOK:"plugin.like.rlOK",comment:"plugin.like.comment"},email:{data:"plugin.email.data",redirect:"plugin.email.redirect"},group:{subscribed:"plugin.groups.subscribed"}},like:{buttonsWithComment:{},Button:function(a){var b=mailru.utils.uniqid(),c=mailru.utils.parseGet((a.getAttribute("href").match(/\?(.*)/)||[0,""])[1]);c.title&&(a.params.title=c.title),c.desc&&(a.params.desc=c.desc),c.description&&(a.params.desc=c.description),c.image_url&&(a.params.imageurl=c.image_url),c.imageurl&&(a.params.imageurl=c.imageurl),c.share_url&&(a.params.url=c.share_url),c.url&&(a.params.url=c.url),!a.params.url||!a.params.url.length||-1===a.getAttribute("href").indexOf("share_url=")&&-1===a.getAttribute("href").indexOf("url=")?a.params.url=document.location.href:(-1===a.params.url.indexOf("http://")&&(a.params.url="http://"+a.params.url),a.params.url=window.unescape(a.params.url)),c.swfurl&&(a.params.video=c.swfurl),c.width&&(a.params.vwidth=c.width),c.height&&(a.params.vheight=c.height),c.screenshot&&(a.params.imageurl=c.screenshot),a.params.buttonID=b,a.params.faces_count=10,a.params.sz=a.params.height=a.params.sz||a.params.size||21,a.params.st=a.params.st||a.params.style||"oval",(a.params.tp||a.params.type)&&(a.params.tp=a.params.tp||a.params.type),c.share_remote&&(a.params.su=c.share_remote),(a.params.sz>12&&a.params.sz<70&&a.params.vt||a.params.vertical&&!a.params.nc)&&(a.params.vt=1,a.params.height*=3),a.params.width=a.params.width||"100%",a.insertOptions.wrap=!0,a.params.caption=a.innerHTML,mailru.isIE&&(a.params.desc&&(a.params.desc=a.params.desc.substr(0,200)),a.params.title&&(a.params.title=a.params.title.substr(0,100)))},Comment:function(a){if(void 0===a)return!1;var b=a.wid,c=a.history_id,d=a.type,e=a.OK_uid,f=a.buttonType,g=a.offset||0,h=a.crosspost||!1,i=a.checkCrosspost||!1,j=a.avatar||!1,k=document.getElementById(b);if(h)return!1;if(!b||!c&&(void 0===d||"ok"!==d)||"undefined"===b||"ok"===d&&void 0===e)return!1;f=f||"",d=d||"",j=j||"";var l={noreplace:!0,position:mailru.utils.window.getPosition(k),body:!0};g&&(l.position.left+=+g);var m={position:"absolute",display:"block",zIndex:"1000",overflow:"auto",margin:parseInt(k.style.height,10)+"px 0 0"},n=mailru.def.LIKE.COMMENT_URL+"buttonID="+b+"&";"uber-share"===f&&(n+="uber-share=1&"),k.src.indexOf("&type=small")>=0&&(n+="small=1&"),k.src.indexOf("&nt=1")>=0&&(n+="super-small=1&");var o={wid:mailru.plugin.like.buttonsWithComment[b],type:"insertable",place:k,insertOptions:l,url:{history_id:c},style:m};i&&(n+="checkCrosspost=1&"),mailru.plugin.like.buttonsWithComment[b]=mailru.utils.uniqid(),mailru.utils.modal.open(n,o)},closeAllComments:function(a){var b;for(b in mailru.plugin.like.buttonsWithComment)mailru.plugin.like.buttonsWithComment.hasOwnProperty(b)&&mailru.utils.modal.close(mailru.plugin.like.buttonsWithComment[b]);"function"==typeof a&&a()},errorMessage:function(a,b,c){c=c||"";var d=document.getElementById(a),e={noreplace:!0,position:mailru.utils.window.getPosition(d),body:!0},f={position:"absolute",display:"block",zIndex:"1000",overflow:"auto",margin:parseInt(d.style.height,10)+"px 0 0"},g=mailru.def.LIKE.COMMENT_URL;"uber-share"===c&&(g+="uber-share=1&"),mailru.plugin.like.buttonsWithComment[a]=mailru.utils.uniqid(),mailru.utils.modal.open(g,{wid:mailru.plugin.like.buttonsWithComment[a],type:"insertable",place:d,insertOptions:e,url:{error_type:b},style:f})},rl:function(a){var b,c,d,e,f,g=a.wid||!1,h=a.buttonType||"";return g&&"undefined"!==g?(b=document.getElementById(g),c={noreplace:!0,position:mailru.utils.window.getPosition(b),body:!0},d={position:"absolute",display:"block",zIndex:"1000",overflow:"auto",margin:parseInt(b.style.height,10)+"px 0 0"},e=mailru.plugin.elements[g],delete e.height,delete e.app_id,delete e.wid,delete e.height,delete e.width,e.like_id=g,e.buttonID=g,e.rl=1,f=mailru.def.LIKE.CAPTCHA_URL,"uber-share"===h&&(f+="uber-share=1&"),mailru.plugin.like.buttonsWithComment[g]=mailru.utils.uniqid(),void mailru.utils.modal.open(f,{wid:mailru.plugin.like.buttonsWithComment[g],type:"insertable",place:b,insertOptions:c,url:e,style:d})):!1}},email:{redirectTo:function(a){a&&(document.location=a)}}},mailru.loader.onready("api")}();